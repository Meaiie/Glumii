<!DOCTYPE html>
<html lang="th">
<head>
┬а ┬а <meta charset="UTF-8">
┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">
┬а ┬а <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕Щр╣Др╕Вр╣Йр╕кр╕Хр╕гр╕╡р╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М</title>
┬а ┬а <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> </head>
<body>
┬а ┬а <div class="container">
┬а ┬а ┬а ┬а <div class="header">
┬а ┬а ┬а ┬а ┬а ┬а <h1>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕Щр╣Др╕Вр╣Йр╕кр╕Хр╕гр╕╡р╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М</h1>
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а <div class="form-container">
┬а ┬а ┬а ┬а ┬а ┬а <div id="liffStatus" class="liff-status liff-disconnected">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ЁЯФД р╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н LINE...
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а <form id="patientForm" style="display: none;"> 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="full_name">р╕Кр╕╖р╣Ир╕н-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="full_name" name="full_name" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="nickname">р╕Кр╕╖р╣Ир╕нр╣Ар╕ер╣Ир╕Щ *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="nickname" name="nickname" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="hospital_id">р╕гр╕лр╕▒р╕кр╣Вр╕гр╕Зр╕Юр╕вр╕▓р╕Ър╕▓р╕е *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="hospital_id" name="hospital_id" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="national_id">р╣Ар╕ер╕Вр╕Ър╕▒р╕Хр╕гр╕Ыр╕гр╕░р╕Кр╕▓р╕Кр╕Щ *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="national_id" name="national_id" pattern="[0-9]{13}" maxlength="13" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="birth_date">р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="birth_date" name="birth_date" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="height">р╕кр╣Ир╕зр╕Щр╕кр╕╣р╕З (р╕Лр╕б.) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="height" name="height" min="100" max="200" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕╕р╕Вр╕ар╕▓р╕Ю</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group full-width">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label>р╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕з *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" id="chronicDiseaseNo" name="chronicDisease" value="р╣Др╕бр╣Ир╕бр╕╡" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="chronicDiseaseNo">р╣Др╕бр╣Ир╕бр╕╡</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" id="chronicDiseaseYes" name="chronicDisease" value="р╕бр╕╡" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="chronicDiseaseYes">р╕бр╕╡</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="conditional-input" id="chronicDiseaseDetail"> 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="comorbidities" name="comorbidities" placeholder="р╕гр╕░р╕Ър╕╕р╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕з">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group full-width">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label>р╕вр╕▓р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Бр╣Ир╕нр╕Щр╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" id="medicationNo" name="medication" value="р╣Др╕бр╣Ир╕бр╕╡" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="medicationNo">р╣Др╕бр╣Ир╕бр╕╡</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="radio-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" id="medicationYes" name="medication" value="р╕бр╕╡" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="medicationYes">р╕бр╕╡</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="conditional-input" id="medicationDetail">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <textarea id="pre_pregnancy_medications" name="pre_pregnancy_medications" rows="3" placeholder="р╕гр╕░р╕Ър╕╕р╕вр╕▓р╕Чр╕╡р╣Ир╣Гр╕Кр╣Й"></textarea>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="pre_pregnancy_weight">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Бр╣Ир╕нр╕Щр╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М (р╕Бр╕Б.) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="pre_pregnancy_weight" name="pre_pregnancy_weight" min="30" max="150" step="0.1" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weight">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ (р╕Бр╕Б.) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="weight" name="weight" min="30" max="150" step="0.1" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="fetus_count">р╕Ир╕│р╕Щр╕зр╕Щр╕Чр╕▓р╕гр╕Бр╣Гр╕Щр╕Др╕гр╕гр╕ар╣М *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <select id="fetus_count" name="fetus_count" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="">р╣Ар╕ер╕╖р╕нр╕Бр╕Ир╕│р╕Щр╕зр╕Щр╕Чр╕▓р╕гр╕Б</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="1">1 р╕Др╕Щ</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="2">2 р╕Др╕Щ</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="3">3 р╕Др╕Щ</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="4">4 р╕Др╕Щ р╕лр╕гр╕╖р╕нр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </select>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="due_date">р╕зр╕▒р╕Щр╕Др╕гр╕Ър╕Бр╕│р╕лр╕Щр╕Фр╕Др╕ер╕нр╕Ф *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="due_date" name="due_date" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕лр╕ер╕▒р╕Б</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="carb-ratio-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="main_ratio_breakfast">р╕нр╕▓р╕лр╕▓р╕гр╣Ар╕Кр╣Йр╕▓ (Breakfast) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="main_ratio_breakfast" name="main_ratio_breakfast" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 3" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="main_ratio_lunch">р╕нр╕▓р╕лр╕▓р╕гр╕Бр╕ер╕▓р╕Зр╕зр╕▒р╕Щ (Lunch) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="main_ratio_lunch" name="main_ratio_lunch" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 4" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="main_ratio_dinner">р╕нр╕▓р╕лр╕▓р╕гр╣Ар╕вр╣Зр╕Щ (Dinner) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="main_ratio_dinner" name="main_ratio_dinner" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 3" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕гр╕нр╕З</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="carb-ratio-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="snack_ratio_morning">р╕бр╕╖р╣Йр╕нр╣Ар╕Кр╣Йр╕▓ (Morning Snack) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="snack_ratio_morning" name="snack_ratio_morning" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 1" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="snack_ratio_afternoon">р╕бр╕╖р╣Йр╕нр╕Ър╣Ир╕▓р╕в (Afternoon Snack) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="snack_ratio_afternoon" name="snack_ratio_afternoon" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 1.5" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="snack_ratio_evening">р╕бр╕╖р╣Йр╕нр╕Др╣Ир╕│ (Evening Snack) *</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="snack_ratio_evening" name="snack_ratio_evening" step="0.1" min="0" placeholder="р╣Ар╕Кр╣Ир╕Щ 0.5" required>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-section">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="section-title">р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Ир╕▓р╕░р╕Щр╣Йр╕│р╕Хр╕▓р╕е (р╣Ар╕ер╕╖р╕нр╕Б 2 р╕зр╕▒р╕Щ)</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="monday" class="sugar-check" value="р╕Ир╕▒р╕Щр╕Чр╕гр╣М">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="monday">р╕Ир╕▒р╕Щр╕Чр╕гр╣М</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="tuesday" class="sugar-check" value="р╕нр╕▒р╕Зр╕Др╕▓р╕г">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="tuesday">р╕нр╕▒р╕Зр╕Др╕▓р╕г</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="wednesday" class="sugar-check" value="р╕Юр╕╕р╕Ш">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="wednesday">р╕Юр╕╕р╕Ш</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="thursday" class="sugar-check" value="р╕Юр╕др╕лр╕▒р╕кр╕Ър╕Фр╕╡">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="thursday">р╕Юр╕др╕лр╕▒р╕кр╕Ър╕Фр╕╡</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="friday" class="sugar-check" value="р╕ир╕╕р╕Бр╕гр╣М">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="friday">р╕ир╕╕р╕Бр╕гр╣М</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="saturday" class="sugar-check" value="р╣Ар╕кр╕▓р╕гр╣М">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="saturday">р╣Ар╕кр╕▓р╕гр╣М</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="checkbox-item">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="checkbox" id="sunday" class="sugar-check" value="р╕нр╕▓р╕Чр╕┤р╕Хр╕вр╣М">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="sunday">р╕нр╕▓р╕Чр╕┤р╕Хр╕вр╣М</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button type="submit" class="submit-btn" disabled>ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="loading" id="loading">тП│ р╕Бр╕│р╕ер╕▒р╕Зр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е...</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="success-message" id="successMessage">тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з!</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="error-message" id="errorMessage">тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕Бр╕гр╕╕р╕Ур╕▓р╕ер╕нр╕Зр╣Гр╕лр╕бр╣Ир╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З</div>
┬а ┬а ┬а ┬а ┬а ┬а </form>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>

┬а ┬а <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    ┬а ┬а <script>
┬а ┬а ┬а ┬а let isLiffReady = false;
┬а ┬а ┬а ┬а let liffUserId = null; 

┬а ┬а ┬а ┬а async function initializeLiff() {
┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // **р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ LIFF ID р╕Вр╕нр╕Зр╕Др╕╕р╕У**
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await liff.init({ liffId: "2007493917-XdpdZalP" }); 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!liff.isLoggedIn()) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а liff.login();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isLiffReady = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('liffStatus').className = 'liff-status liff-connected';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('liffStatus').innerHTML = 'тЬЕ р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н LINE р╕кр╕│р╣Ар╕гр╣Зр╕И';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const profile = await liff.getProfile();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а liffUserId = profile.userId;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await checkUserProfile(liffUserId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕бр╣Ар╕бр╕╖р╣Ир╕нр╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('.submit-btn').disabled = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('LIFF initialization failed:', error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('liffStatus').innerHTML = 'тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н LINE р╣Др╕Фр╣Й';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'block'; 
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function checkUserProfile(userId) {
┬а ┬а ┬а ┬а ┬а ┬а console.log('Checking user profile for userId:', userId);
┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const url = '/.netlify/functions/apps-script-proxy'; 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Гр╕Кр╣Й GET request р╕кр╕│р╕лр╕гр╕▒р╕Ъ checkUser
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const response = await fetch(`${url}?action=checkUser&userId=${userId}`, {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а method: 'GET',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!response.ok) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const errorDetails = await response.text();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б: р╕Др╕зр╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▓р╕г parse JSON р╣Гр╕Щр╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣И Apps Script р╕кр╣Ир╕З text error р╕бр╕▓
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const jsonError = JSON.parse(errorDetails);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а throw new Error(`HTTP error! Status: ${response.status}, Message: ${jsonError.message || 'Unknown error'}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (e) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а throw new Error(`HTTP error! Status: ${response.status}, Details: ${errorDetails.substring(0, 100)}...`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const result = await response.json();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.log('User check response from Netlify Function:', result);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (result.status === 'profile_exists') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const profileData = result.profileData;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕Хр╕┤р╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('full_name').value = profileData.full_name || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('nickname').value = profileData.nickname || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('hospital_id').value = profileData.hospital_id || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('national_id').value = profileData.national_id || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('birth_date').value = profileData.birth_date || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('height').value = profileData.height || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕з (р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щ Event р╣Ар╕Юр╕╖р╣Ир╕нр╣Бр╕кр╕Фр╕Зр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (profileData.comorbidities && profileData.comorbidities !== 'р╣Др╕бр╣Ир╕бр╕╡') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('chronicDiseaseYes').checked = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('comorbidities').value = profileData.comorbidities;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('chronicDiseaseNo').checked = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('input[name="chronicDisease"]:checked')?.dispatchEvent(new Event('change'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕вр╕▓р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Бр╣Ир╕нр╕Щр╕Хр╕▒р╣Йр╕Зр╕Др╕гр╕гр╕ар╣М (р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щ Event р╣Ар╕Юр╕╖р╣Ир╕нр╣Бр╕кр╕Фр╕Зр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (profileData.pre_pregnancy_medications && profileData.pre_pregnancy_medications !== 'р╣Др╕бр╣Ир╕бр╕╡') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('medicationYes').checked = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('pre_pregnancy_medications').value = profileData.pre_pregnancy_medications;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('medicationNo').checked = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('input[name="medication"]:checked')?.dispatchEvent(new Event('change'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('pre_pregnancy_weight').value = profileData.pre_pregnancy_weight || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('weight').value = profileData.weight || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('fetus_count').value = profileData.fetus_count || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('due_date').value = profileData.due_date || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕лр╕ер╕▒р╕Б (main_ratio)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (profileData.main_ratio) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Чр╕▒р╣Йр╕З string р╣Бр╕ер╕░ object
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const mainRatio = typeof profileData.main_ratio === 'string' ? JSON.parse(profileData.main_ratio) : profileData.main_ratio;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('main_ratio_breakfast').value = mainRatio.breakfast || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('main_ratio_lunch').value = mainRatio.lunch || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('main_ratio_dinner').value = mainRatio.dinner || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (e) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error parsing main_ratio:", e);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕гр╕нр╕З (snack_ratio)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (profileData.snack_ratio) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Чр╕▒р╣Йр╕З string р╣Бр╕ер╕░ object
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const snackRatio = typeof profileData.snack_ratio === 'string' ? JSON.parse(profileData.snack_ratio) : profileData.snack_ratio;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('snack_ratio_morning').value = snackRatio.morning || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('snack_ratio_afternoon').value = snackRatio.afternoon || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('snack_ratio_evening').value = snackRatio.evening || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (e) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error parsing snack_ratio:", e);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Ир╕▓р╕░р╕Щр╣Йр╕│р╕Хр╕▓р╕е (р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щ Event р╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░ disabled)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (profileData.sugar_check_days && Array.isArray(profileData.sugar_check_days)) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('.sugar-check').forEach(checkbox => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а checkbox.checked = profileData.sugar_check_days.includes(checkbox.value);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕гр╕╡р╕вр╕Б event listener р╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░ disabled р╕Вр╕нр╕З checkbox
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const event = new Event('change');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щр╕Чр╕╡р╣И Checkbox р╕Хр╕▒р╕зр╣Бр╕гр╕Бр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╣Ар╕ер╕╖р╕нр╕Б р╕лр╕гр╕╖р╕нр╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕ер╕вр╕Бр╣Зр╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щр╕Хр╕▒р╕зр╣Бр╕гр╕Бр╕Вр╕нр╕Зр╕Бр╕ер╕╕р╣Ир╕б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('.sugar-check')?.dispatchEvent(event);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Бр╕кр╕Фр╕Зр╕Яр╕нр╕гр╣Мр╕б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'block'; 

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (result.status === 'new_user') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Цр╣Йр╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Др╕вр╕Бр╕гр╕нр╕Б р╣Гр╕лр╣Йр╣Бр╕кр╕Фр╕Зр╕Яр╕нр╕гр╣Мр╕б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Error from Apps Script during checkUser:', result.message);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'block'; 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Error checking user profile via Netlify Function:', error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Бр╕кр╕Фр╕Зр╕Яр╕нр╕гр╣Мр╕бр╣Ар╕Ьр╕╖р╣Ир╕нр╣Др╕зр╣Йр╣Гр╕Щр╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'block'; 
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function handleSubmit(event) {
┬а ┬а ┬а ┬а ┬а ┬а event.preventDefault();

┬а ┬а ┬а ┬а ┬а ┬а const form = document.getElementById('patientForm');
┬а ┬а ┬а ┬а ┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Вр╕нр╕Зр╕Яр╕нр╕гр╣Мр╕бр╕Хр╕▓р╕бр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ HTML5
┬а ┬а ┬а ┬а ┬а ┬а if (!form.checkValidity()) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а// р╕Лр╣Ир╕нр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б error р╣Ар╕Бр╣Ир╕▓р╕Бр╣Ир╕нр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аdocument.getElementById('errorMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аdocument.querySelector('.submit-btn').click(); // р╕Бр╕гр╕░р╕Хр╕╕р╣Йр╕Щр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╕нр╕З browser
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аreturn;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а if (!isLiffReady || !liffUserId) { 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.warn('LIFF not ready or userId not available.');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').innerHTML = 'тЭМ LIFF р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕б р╕Бр╕гр╕╕р╕Ур╕▓р╕ер╕нр╕Зр╣Гр╕лр╕бр╣И';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => document.getElementById('errorMessage').style.display = 'none', 5000);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const selectedSugarCheck = Array.from(document.querySelectorAll('.sugar-check:checked')).map(cb => cb.value);
┬а ┬а ┬а ┬а ┬а ┬а if (selectedSugarCheck.length !== 2) { 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').innerHTML = 'тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Б "р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Ир╕▓р╕░р╕Щр╣Йр╕│р╕Хр╕▓р╕е" р╣Гр╕лр╣Йр╕Др╕гр╕Ъ 2 р╕зр╕▒р╕Щ';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, 5000);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('loading').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('successMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('.submit-btn').disabled = true;

┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let comorbidities = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const chronicDiseaseRadio = document.querySelector('input[name="chronicDisease"]:checked');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (chronicDiseaseRadio) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕лр╕▓р╕Бр╣Ар╕ер╕╖р╕нр╕Б "р╕бр╕╡" р╣Бр╕Хр╣Ир╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Бр╕гр╕нр╕Бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф р╕Ир╕░р╕кр╣Ир╕Зр╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕Бр╕гр╕нр╕Б р╕лр╕гр╕╖р╕нр╕Цр╣Йр╕▓р╕зр╣Ир╕▓р╕Зр╕Ир╕░р╕кр╣Ир╕Зр╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╕зр╣Ир╕▓р╕З ('')
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а comorbidities = chronicDiseaseRadio.value === 'р╕бр╕╡' ? (document.getElementById('comorbidities').value || '') : 'р╣Др╕бр╣Ир╕бр╕╡';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а comorbidities = 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let prePregMedications = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const medicationRadio = document.querySelector('input[name="medication"]:checked');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (medicationRadio) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а prePregMedications = medicationRadio.value === 'р╕бр╕╡' ? (document.getElementById('pre_pregnancy_medications').value || '') : 'р╣Др╕бр╣Ир╕бр╕╡';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а prePregMedications = 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const formData = {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а action: 'updateProfile', // р╕кр╣Ир╕З action р╣Др╕Ыр╕Ър╕нр╕Б Apps Script р╕зр╣Ир╕▓р╣Гр╕лр╣Йр╕Чр╕│р╕нр╕░р╣Др╕г
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId: liffUserId, 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: { // р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Ыр╣Зр╕Щ object р╕ар╕▓р╕вр╣Гр╕Хр╣Й key 'data'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а full_name: document.getElementById('full_name').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а nickname: document.getElementById('nickname').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а hospital_id: document.getElementById('hospital_id').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а national_id: document.getElementById('national_id').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а birth_date: document.getElementById('birth_date').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а comorbidities,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а pre_pregnancy_medications: prePregMedications,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а pre_pregnancy_weight: parseFloat(document.getElementById('pre_pregnancy_weight').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weight: parseFloat(document.getElementById('weight').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а height: parseFloat(document.getElementById('height').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fetus_count: parseInt(document.getElementById('fetus_count').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а due_date: document.getElementById('due_date').value || '',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕лр╕ер╕▒р╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а main_ratio: { 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а breakfast: parseFloat(document.getElementById('main_ratio_breakfast').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а lunch: parseFloat(document.getElementById('main_ratio_lunch').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dinner: parseFloat(document.getElementById('main_ratio_dinner').value) || 0
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕нр╕▒р╕Хр╕гр╕▓р╕кр╣Ир╕зр╕Щр╕бр╕╖р╣Йр╕нр╕гр╕нр╕З
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а snack_ratio: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а morning: parseFloat(document.getElementById('snack_ratio_morning').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а afternoon: parseFloat(document.getElementById('snack_ratio_afternoon').value) || 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а evening: parseFloat(document.getElementById('snack_ratio_evening').value) || 0
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sugar_check_days: selectedSugarCheck
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.log('Sending data:', JSON.stringify(formData, null, 2));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const url = '/.netlify/functions/apps-script-proxy'; 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const response = await fetch(url, {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а method: 'POST',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а headers: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 'Content-Type': 'application/json'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а body: JSON.stringify(formData)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!response.ok) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const errorDetails = await response.text(); 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Вр╕вр╕Щ Error р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф HTTP status
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а throw new Error(`Failed to update profile. HTTP Status: ${response.status}. Details: ${errorDetails.substring(0, 100)}...`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const result = await response.json();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (result.success) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('loading').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('successMessage').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.log('тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И!');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('successMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('.submit-btn').disabled = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Redirect р╣Др╕Ы Profile.html 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а liff.openWindow({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а url: `${window.location.origin}/profile.html`, // р╣Гр╕Кр╣Й window.location.origin р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕вр╕╖р╕Фр╕лр╕вр╕╕р╣Ир╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а external: false
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, 3000);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Вр╕вр╕Щ Error р╕Чр╕╡р╣Ир╕бр╕▓р╕Ир╕▓р╕Б Apps Script/Backend
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а throw new Error(`Server reported failure: ${result.message || 'Unknown Apps Script error'}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('тЭМ Submit Error:', error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('loading').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'block';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б Error р╕Чр╕╡р╣Ир╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Вр╕╢р╣Йр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').innerHTML = `тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: ${error.message}`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('.submit-btn').disabled = false;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('errorMessage').style.display = 'none';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, 8000);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а document.addEventListener('DOMContentLoaded', () => {
┬а ┬а ┬а ┬а ┬а ┬а // р╕Лр╣Ир╕нр╕Щр╕Яр╕нр╕гр╣Мр╕бр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').style.display = 'none';

┬а ┬а ┬а ┬а ┬а ┬а // Logic р╣Бр╕кр╕Фр╕З/р╕Лр╣Ир╕нр╕Щр╕Кр╣Ир╕нр╕Зр╕гр╕░р╕Ър╕╕р╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕з
┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('input[name="chronicDisease"]').forEach(radio => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а radio.addEventListener('change', function () {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const detail = document.getElementById('chronicDiseaseDetail');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const input = document.getElementById('comorbidities');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (this.value === 'р╕бр╕╡') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а detail.classList.add('show');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.required = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а detail.classList.remove('show');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.required = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕ер╕Ър╕Др╣Ир╕▓р╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ 'р╣Др╕бр╣Ир╕бр╕╡' р╣Ар╕Ьр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Ьр╕ер╕нр╕Бр╕Ф
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // input.value = ''; 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а // Logic р╣Бр╕кр╕Фр╕З/р╕Лр╣Ир╕нр╕Щр╕Кр╣Ир╕нр╕Зр╕гр╕░р╕Ър╕╕р╕вр╕▓
┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('input[name="medication"]').forEach(radio => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а radio.addEventListener('change', function () {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const detail = document.getElementById('medicationDetail');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const textarea = document.getElementById('pre_pregnancy_medications');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (this.value === 'р╕бр╕╡') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а detail.classList.add('show');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а textarea.required = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а detail.classList.remove('show');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а textarea.required = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕ер╕Ър╕Др╣Ир╕▓р╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ 'р╣Др╕бр╣Ир╕бр╕╡' р╣Ар╕Ьр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Ьр╕ер╕нр╕Бр╕Ф
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // textarea.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Вр╕нр╕Зр╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╣Бр╕ер╕░р╕вр╕▓
┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('input[name="chronicDisease"]:checked')?.dispatchEvent(new Event('change'));
┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('input[name="medication"]:checked')?.dispatchEvent(new Event('change'));

┬а ┬а ┬а ┬а ┬а ┬а // Logic р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕Ир╕▓р╕░р╕Щр╣Йр╕│р╕Хр╕▓р╕ер╣Др╕Фр╣Йр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 2 р╕зр╕▒р╕Щ
┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('.sugar-check').forEach(checkbox => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а checkbox.addEventListener('change', function () {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const checked = document.querySelectorAll('.sugar-check:checked');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (checked.length >= 2) { 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('.sugar-check:not(:checked)').forEach(cb => cb.disabled = true);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.querySelectorAll('.sugar-check').forEach(cb => cb.disabled = false);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а // р╕Бр╕│р╕лр╕Щр╕Фр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Др╕гр╕Ър╕Бр╕│р╕лр╕Щр╕Фр╕Др╕ер╕нр╕Фр╕Вр╕▒р╣Йр╕Щр╕Хр╣Ир╕│ (р╕зр╕▒р╕Щр╕Щр╕╡р╣Й)
┬а ┬а ┬а ┬а ┬а ┬а const today = new Date().toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('due_date').min = today;

┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ LIFF р╣Бр╕ер╕░р╕Ьр╕╣р╕Б Event Listener
┬а ┬а ┬а ┬а ┬а ┬а initializeLiff();
┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('patientForm').addEventListener('submit', handleSubmit);
┬а ┬а ┬а ┬а });
┬а ┬а </script>
</body>
</html>